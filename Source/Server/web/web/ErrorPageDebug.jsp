<%--
/*
 * @(#)ErrorPage.jsp
 *
 * Copyright (c) Massachusetts Institute of Technology
 * 77 Massachusetts Avenue, Cambridge, MA 02139-4307
 * All rights reserved.
 *
 * Created on April 7, 2002, 11:22 AM
 *
 * @author  RYK
 * @version 1.0
 */
--%>

<%-- Coeus Error Page --%>

<%@page isErrorPage="true" import="edu.mit.coeus.exception.CoeusException,
                                   edu.mit.coeus.utils.UtilFactory,
                                   edu.mit.coeus.utils.dbengine.DBException"%>
<%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %>
<%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %>
<%@ taglib uri="/WEB-INF/struts-logic.tld" prefix="logic" %>

<jsp:include page="CoeusCacheRemove.jsp" flush="true" />
<%@include file="CoeusContextPath.jsp"  %>

<%
Exception objException = (Exception)request.getAttribute("EXCEPTION");
 //UtilFactory objUtilFact = new UtilFactory();
String exceptionType = "Server encountered an unknown error.";
String execCode = "";
String errorMessage  = "";
if(objException!=null){
		System.out.println("objException != null ");
		System.out.println("objException.getClass().getName(): "+objException.getClass().getName());
           String strExceCode = "";
           if(objException instanceof CoeusException){
			   exceptionType = " Coeus encountered an exception";
			   CoeusException coeusEx = (CoeusException)objException;
			   execCode = coeusEx.getUserMessage();
			   errorMessage=coeusEx.getUserMessage();
			   System.out.println("errorMessage: "+errorMessage);
			   //errorMessage+="<br />"+coeusEx.getMessage();
		   }else  if(objException instanceof DBException){
			    exceptionType = "Coeus encountered Database error.";
			    DBException dbEx = (DBException)objException;
			    execCode = dbEx.getUserMessage();
			    execCode += dbEx.getMessage();
			    errorMessage=dbEx.getUserMessage();
			    errorMessage+="<br />"+dbEx.getMessage();
		   } else {
		   		errorMessage=objException.getClass().getName();
			    errorMessage+="<br />"+objException.getMessage();
		   }

} else if(objException == null){
	//exception.getMessage();
	//objUtilFact.log(exception.getMessage(),((Exception)exception),"Error Page","");
	System.out.println("Error generated by a JSP");
	errorMessage = exception.getClass().getName();
	errorMessage += "<br />"+exception.getMessage();
}
%>
<html:html locale="true">
<head>
<title><bean:message key="errorPage.title" /></title>
<html:base/>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style type="text/css">
div {font-family:verdana;font-size:10px}
a {font-family:verdana;font-size:10px;color:blue;text-decoration:none;}
a:active {color:red;text-decoration:none;}
a:visited {color:blue;text-decoration:none;}
a:hover {color:red;text-decoration:none;}
</style>
<script language="JavaScript">
</script>
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">

<jsp:include page="CoeusHeader.jsp"  flush="true" />

  <table width="780" border="0" cellspacing="0" cellpadding="1"  bgcolor="#CCCCCC">
    <tr>
      <td>
        <table width="780" border="0" cellspacing="0" cellpadding="0" >
          <tr>
            <td valign="top">
              <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
                <tr bgcolor="#cccccc">
                  <td height="23"> &nbsp;<font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>
                  <bean:message key="errorPage.header" />
                    </b></font></td>
                </tr>
                <tr>
                  <td height="23">
                    <table width="100%" border="0" cellspacing="0" cellpadding="3">

                      <tr>
                        <td height="100">
                          <div align="center"> <font size="3"> <%=exceptionType%>  </font></div>
                        </td>
                      </tr>                      
                      <tr>
			  <td height="100">
			  <div align="center"> <font face="Verdana, Arial, Helvetica, sans-serif" size="2">
			  <%if(execCode.indexOf("exceptionCode") != -1){ %>
				<bean:message key="<%=errorMessage%>" />
				<%}else{%>
				<%=errorMessage%>
				<%}%>

				  </font></div>
			  </td>
		</tr>
                <tr>
                  <!-- CASE #665 Comment Begin -->
                  <%--
                  <td height="23">
                    <div align="center"><A href='javascript:history.back()'><img src="<bean:write name="ctxtPath" />/images/goback.gif" border='0' width="42" height="22"></A>
                    </div>
                  </td>
                  --%>
                  <!-- CASE #665 Comment End -->
                  <!-- CASE #665 Begin -->
                  <!-- If error is from duplicate submission, don't show Back Button.  Show OK button to take user to submitted financial entity or disclosure. -->
                  <td height="23" align="center" >
                  <logic:notPresent name="dupSubmission" scope="request">
			<a href='javascript:history.back()'><img src="<bean:write name="ctxtPath" />/images/goback.gif" border='0' width="42" height="22"></a>
		</logic:notPresent>
		<logic:present name="dupSubmission" scope="request">
			<logic:present name="dupSubmissionTempProp">
				<bean:message key="errorPage.dupTempPropSubmissionMsg" />
				<p />
				<a href="<bean:write name='ctxtPath'/>/getcoidisclosure.do"<img src="<bean:write name='ctxtPath'/>/images/ok.gif" border="0"></a>
			</logic:present>		
			<logic:present name="disclosureNumEP">
				<bean:message key="errorPage.dupDiscSubmissionMsg" />
				<p />
				<a href="<bean:write name='ctxtPath'/>/viewCOIDisclosureDetails.do?action=view&disclNo=<bean:write name='disclosureNumEP'/>"><img src="<bean:write name='ctxtPath'/>/images/ok.gif" border="0"></a>
			</logic:present>
			<logic:present name="entityNumber">
				<logic:equal name="actionType" value="I">
					<bean:message key="errorPage.dupInsertFEMsg" />
				</logic:equal>
				<logic:equal name="actionType" value="U">
					<bean:message key="errorPage.dupUpdateFEMsg" />
				</logic:equal>
				<p />
				<a href='<bean:write name='ctxtPath'/>/viewFinEntity.do?actionFrom=<bean:write name="actionFrom"/>&entityNo=<bean:write name="entityNumber"/>&seqNo=<bean:write name="seqNo"/>'><img src="<bean:write name='ctxtPath'/>/images/ok.gif" border="0"></a>				
			</logic:present>
		</logic:present>
		</td>
                  <!-- CASE #665 End -->
                </tr>		
                    <tr>
                       	<td height="100">
			<div align="center"> <font face="Verdana, Arial, Helvetica, sans-serif" size="2">Exception Details </font> </div>
                        </td>
                     </tr>                                         
			<tr>
			<td>
			<font face="Verdana, Arial, Helvetica, sans-serif" size="2">
       <%
			java.io. StringWriter sw = new java.io.StringWriter();
			   java.io.PrintWriter pw = new java.io.PrintWriter(sw);
			   if(objException == null){
				out.print("Error generated on a JSP, not thrown from within the application");
				exception.printStackTrace(pw);
			   }
			   else{
				out.print("Error generated in the application, not from compiling a JSP");
				objException.printStackTrace(pw);
			  }
			  out.print("<br />");
			  out.print(sw);
			  sw.close();
			  pw.close();
			   %>
			   </font>
			<td>
                       	<td height="100">
                       	   <div align="center"> <font face="Verdana, Arial, Helvetica, sans-serif" size="2">	 </font> </div>
                        </td>

                    </tr>                    
                    </table>
                  </td>
                </tr>

              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>

</body>
</html:html>
